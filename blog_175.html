<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>
<title>CPU&#x6307;&#x4EE4;&#x96C6;&#x7684;&#x865A;&#x62DF;&#x5316;&#xFF08;x86&#xFF09;</title>
<body><blockquote> <h5>IA-32 (x86)[<a href="http://en.wikipedia.org/w/index.php?title=Popek_and_Goldberg_virtualization_requirements&amp;action=edit&amp;section=8">edit</a>]</h5> <p>Main article: <a href="http://en.wikipedia.org/wiki/X86_virtualization">X86 virtualization</a> <p>The <a href="http://en.wikipedia.org/wiki/IA-32">IA-32</a> instruction set of the <a href="http://en.wikipedia.org/wiki/Intel_P5_(microarchitecture)">Pentium</a> processor contains 17 sensitive, unprivileged instructions.<sup><a href="http://en.wikipedia.org/wiki/Popek_and_Goldberg_virtualization_requirements#cite_note-11">[11]</a></sup> They can be categorized in two groups: <ul> <li>Sensitive register instructions: read or change sensitive registers and/or memory locations such as a clock register or interrupt registers:  <ul> <li><strong>SGDT, SIDT, SLDT </strong> <li><strong>SMSW </strong> <li><strong>PUSHF, POPF</strong></li></ul> <li>Protection system instructions: reference the storage protection system, memory or address relocation system:  <ul> <li><strong>LAR, LSL, VERR, VERW </strong> <li><strong>POP </strong> <li><strong>PUSH </strong> <li><strong>CALL, JMP, INT n, RET </strong> <li><strong>STR </strong> <li><strong>MOV</strong></li></ul></li></ul> <p>The introduction of the <a href="http://en.wikipedia.org/wiki/AMD-V">AMD-V</a> and <a href="http://en.wikipedia.org/wiki/Intel_VT-x">Intel VT-x</a> instruction sets in 2005 allows x86 processors to meet the Popek and Goldberg virtualization requirements.</p></blockquote> <h3>关键指令(Critical Instruction)</h3> <p>指敏感但非特权指令，需要在Guest OS中人为地在CI指令处做trap处理，以便由VMM进行处理。</p> <h3>CI指令的扫描与修补(Scanning and Patching)</h3> <p>以代码块为单位，对Guest OS以及其中运行的程序代码进行扫描，遇到分支指令时，深入到每个分支进行扫描和修补。</p> <p>修补方法，就是将CI指令替换成相应的trap指令，确保VMM有机会处理到所有敏感指令。</p></body>
</html>
