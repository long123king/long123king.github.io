<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>
<title>DPL, CPL&#x53CA;RPL&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;</title>
<body><h3>DPL: Descriptor Privilege Level</h3> <h4>1） GDT/LDT表中的描述符</h4> <p>GDT/LDT表中的描述符，描述的是一段内存。</p> <p>&nbsp;</p> <p>其中的DPL代表着GDT/LDT中的描述符<strong>描述的内存段</strong>的特权级别。</p> <p>比如，当前正在执行的代码，它的特权级别就是当前的CS段选择子指向的段描述符中的DPL所决定的。</p> <p>即DPL是描述<strong>一段内存</strong>的特权级别。</p> <p>&nbsp;</p> <h4>2） IDT表中的描述符</h4> <p>IDT表中的描述符，描述的是一个门。</p> <p>门的概念，与“植物大战僵尸”里面的传送门类似：</p> <p>&nbsp;</p> <p><a href="http://images.cnitblog.com/blog/580388/201401/02112650-1a4b859667a94529b41964c8881105f4.jpg"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; margin-left: auto; border-left-width: 0px; margin-right: auto; padding-top: 0px" title="Gate" border="0" alt="Gate" src="http://images.cnitblog.com/blog/580388/201401/02112650-5d15f60a642f423799c1981c88c55ed4.jpg" width="620" height="484"></a></p> <p>&nbsp;</p> <p>假设，上图中的每一行都是有特权级别的，上面行的特权级别比下面行的特权级别高，那么从A处发出的豌豆是无法打中B处的僵尸的。</p> <p>但是有了传送门，它可以帮忙将A出打出的豌豆提升到B处，从而打中B处的僵尸。</p> <p>&nbsp;</p> <p>Gate Descriptor的作用也类似，它可以用来帮助提升请求请求代码的特权级别。</p> <p>使原本没有特权执行内核态代码的用户态程序，可以在Gate的帮助下，执行内核态的代码。</p> <p>&nbsp;</p> <p>&nbsp;</p> <h3>CPL：Current Privilege Level</h3> <p>代表着当前执行的代码段的特权级别</p> <p>&nbsp;</p> <h3>RPL：Request Privilege Level</h3> <p>用于描述段选择子。</p> <p>&nbsp;</p> <p>段选择子是用来<strong>选择</strong>GDT/LDT中段描述符描述的内存段的。</p> <p>&nbsp;</p> <p>RPL代表着一次申请访问估内容时，使用的特权级别，用RPL来代替请求程序本身的CPL，用于特权级别检查。</p> <p>&nbsp;</p> <p>下面我们查看一个例子：</p> <p>IDT中第0x80项代表“系统调用”的入口：</p> <div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper"> <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum1">   1:</span> [  80] 0x00000060[index=000C, TI=0, RPL=0] : 0xc152c898, P[1] DPL[3] Type[       Trap Gate] </pre><!--CRLF--></div></div>

<p>而它里面的0x00000060段选择子，选择的是GDT中的0x000C项</p>
<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
<div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum1">   1:</span> [   C] 0x00000000 : 0xffffffff, G[1] D/B[1] P[1] DPL[0] S[1] Type[11] Code[Read-Enable Accessed ]</pre><!--CRLF--></div></div>

<p>根据这个例子，我们可以理解为</p>
<p>1） 用户态程序的CPL为3， 它请求的Gate描述符项的DPL为3，请求通过。</p>
<p>2） Gate描述符进一步代表用户态程序请求访问内核态的代码段时，RPL为0， 而目标代码段的DPL也为0，这一步请求也通过。</p></body>
</html>
