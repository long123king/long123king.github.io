<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>
<title>Linux&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x7684;&#x5185;&#x6838;&#x4EE3;&#x7801;&#x5206;&#x6790;</title>
<body><p>参考上文：</p> <p><a title="http://www.cnblogs.com/long123king/p/3543872.html" href="http://www.cnblogs.com/long123king/p/3543872.html">http://www.cnblogs.com/long123king/p/3543872.html</a></p> <p><a title="http://www.cnblogs.com/long123king/p/3545688.html" href="http://www.cnblogs.com/long123king/p/3545688.html">http://www.cnblogs.com/long123king/p/3545688.html</a></p> <p>&nbsp;</p> <p>补充：linker script documentation</p> <p><a title="http://www.nacad.ufrj.br/online/sgi/860-0247-001/sgi_html/ldLinker_scripts.html" href="http://www.nacad.ufrj.br/online/sgi/860-0247-001/sgi_html/ldLinker_scripts.html">http://www.nacad.ufrj.br/online/sgi/860-0247-001/sgi_html/ldLinker_scripts.html</a></p> <p>参考：<a title="http://blog.chinaunix.net/uid-20499746-id-1663135.html" href="http://blog.chinaunix.net/uid-20499746-id-1663135.html">http://blog.chinaunix.net/uid-20499746-id-1663135.html</a></p> <p><a title="http://blog.csdn.net/redredbird/article/details/5986035" href="http://blog.csdn.net/redredbird/article/details/5986035">http://blog.csdn.net/redredbird/article/details/5986035</a></p> <p>&nbsp;</p> <p>同类文章参考：</p> <p><a title="http://blog.chinaunix.net/uid-1701789-id-148056.html" href="http://blog.chinaunix.net/uid-1701789-id-148056.html">http://blog.chinaunix.net/uid-1701789-id-148056.html</a></p> <p><a title="http://www.cnblogs.com/cybertitan/archive/2012/09/29/2708184.html" href="http://www.cnblogs.com/cybertitan/archive/2012/09/29/2708184.html">http://www.cnblogs.com/cybertitan/archive/2012/09/29/2708184.html</a></p> <h3>1. 内核代码的布局</h3> <p>我们知道，内核代码被加载到物理内存1MB处，然后in_pm32跳转到1MB物理内存处执行。</p> <p>那么1MB物理内存处存放的是什么代码呢？</p> <p>&nbsp;</p> <p>我们先看一个链接器的脚本文件arch/x86/boot/compressed/vmlinux.lds.S</p> <div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper"> <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre><span style="color: #606060" id="lnum1">   1:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>-generic/vmlinux.lds.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum2">   2:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum3">   3:</span> OUTPUT_FORMAT(CONFIG_OUTPUT_FORMAT, CONFIG_OUTPUT_FORMAT, CONFIG_OUTPUT_FORMAT)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum4">   4:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum5">   5:</span> <span style="color: #cc6633">#undef</span> i386</pre><!--CRLF--><pre><span style="color: #606060" id="lnum6">   6:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum7">   7:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>/cache.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum8">   8:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>/page_types.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum9">   9:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum10">  10:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_64</pre><!--CRLF--><pre><span style="color: #606060" id="lnum11">  11:</span> OUTPUT_ARCH(i386:x86-64)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum12">  12:</span> ENTRY(startup_64)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum13">  13:</span> <span style="color: #cc6633">#else</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum14">  14:</span> OUTPUT_ARCH(i386)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum15">  15:</span> ENTRY(startup_32)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum16">  16:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum17">  17:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum18">  18:</span> SECTIONS</pre><!--CRLF--><pre><span style="color: #606060" id="lnum19">  19:</span> {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum20">  20:</span>     <span style="color: #008000">/* Be careful parts of head_64.S assume startup_32 is at</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum21">  21:</span> <span style="color: #008000">     * address 0.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum22">  22:</span> <span style="color: #008000">     */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum23">  23:</span>     . = 0;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum24">  24:</span>     .head.text : {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum25">  25:</span>         _head = . ;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum26">  26:</span>         HEAD_TEXT</pre><!--CRLF--><pre><span style="color: #606060" id="lnum27">  27:</span>         _ehead = . ;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum28">  28:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum29">  29:</span>     .rodata..compressed : {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum30">  30:</span>         *(.rodata..compressed)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum31">  31:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum32">  32:</span>     .text :    {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum33">  33:</span>         _text = .;     <span style="color: #008000">/* Text */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum34">  34:</span>         *(.text)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum35">  35:</span>         *(.text.*)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum36">  36:</span>         _etext = . ;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum37">  37:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum38">  38:</span>     .rodata : {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum39">  39:</span>         _rodata = . ;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum40">  40:</span>         *(.rodata)     <span style="color: #008000">/* read-only data */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum41">  41:</span>         *(.rodata.*)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum42">  42:</span>         _erodata = . ;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum43">  43:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum44">  44:</span>     .got : {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum45">  45:</span>         _got = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum46">  46:</span>         KEEP(*(.got.plt))</pre><!--CRLF--><pre><span style="color: #606060" id="lnum47">  47:</span>         KEEP(*(.got))</pre><!--CRLF--><pre><span style="color: #606060" id="lnum48">  48:</span>         _egot = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum49">  49:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum50">  50:</span>     .data :    {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum51">  51:</span>         _data = . ;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum52">  52:</span>         *(.data)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum53">  53:</span>         *(.data.*)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum54">  54:</span>         _edata = . ;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum55">  55:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum56">  56:</span>     . = ALIGN(L1_CACHE_BYTES);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum57">  57:</span>     .bss : {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum58">  58:</span>         _bss = . ;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum59">  59:</span>         *(.bss)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum60">  60:</span>         *(.bss.*)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum61">  61:</span>         *(COMMON)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum62">  62:</span>         . = ALIGN(8);    <span style="color: #008000">/* For convenience during zeroing */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum63">  63:</span>         _ebss = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum64">  64:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum65">  65:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_64</pre><!--CRLF--><pre><span style="color: #606060" id="lnum66">  66:</span>        . = ALIGN(PAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum67">  67:</span>        .pgtable : {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum68">  68:</span>         _pgtable = . ;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum69">  69:</span>         *(.pgtable)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum70">  70:</span>         _epgtable = . ;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum71">  71:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum72">  72:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum73">  73:</span>     _end = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum74">  74:</span> }</pre><!--CRLF--></div></div>
<p>可见，在vmlinux即内核映像的0地址处存放的是.head.text段。</p>
<blockquote>
<p>#define __HEAD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .section&nbsp;&nbsp;&nbsp; ".head.text","ax"</p>
<p>&nbsp;</p></blockquote>
<p>因此，我们找到下面的代码：arch/x86/boot/compressed/head_32.S</p>
<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
<div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre><span style="color: #606060" id="lnum1">   1:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum2">   2:</span>     __HEAD</pre><!--CRLF--><pre><span style="color: #606060" id="lnum3">   3:</span> ENTRY(startup_32)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum4">   4:</span>     cld</pre><!--CRLF--><pre><span style="color: #606060" id="lnum5">   5:</span>     <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum6">   6:</span> <span style="color: #008000">     * Test KEEP_SEGMENTS flag to see if the bootloader is asking</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum7">   7:</span> <span style="color: #008000">     * us to not reload segments</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum8">   8:</span> <span style="color: #008000">     */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum9">   9:</span>     testb    $(1&lt;&lt;6), BP_loadflags(%esi)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum10">  10:</span>     jnz    1f</pre><!--CRLF--><pre><span style="color: #606060" id="lnum11">  11:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum12">  12:</span>     cli</pre><!--CRLF--><pre><span style="color: #606060" id="lnum13">  13:</span>     movl    $__BOOT_DS, %eax</pre><!--CRLF--><pre><span style="color: #606060" id="lnum14">  14:</span>     movl    %eax, %ds</pre><!--CRLF--><pre><span style="color: #606060" id="lnum15">  15:</span>     movl    %eax, %es</pre><!--CRLF--><pre><span style="color: #606060" id="lnum16">  16:</span>     movl    %eax, %fs</pre><!--CRLF--><pre><span style="color: #606060" id="lnum17">  17:</span>     movl    %eax, %gs</pre><!--CRLF--><pre><span style="color: #606060" id="lnum18">  18:</span>     movl    %eax, %ss</pre><!--CRLF--><pre><span style="color: #606060" id="lnum19">  19:</span> 1:</pre><!--CRLF--></div></div>
<p>以及arch/x86/kernel/head_32.S</p>
<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
<div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre><span style="color: #606060" id="lnum1">   1:</span> <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum2">   2:</span> <span style="color: #008000"> * 32-bit kernel entrypoint; only used by the boot CPU.  On entry,</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum3">   3:</span> <span style="color: #008000"> * %esi points to the real-mode code as a 32-bit pointer.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum4">   4:</span> <span style="color: #008000"> * CS and DS must be 4 GB flat segments, but we don't depend on</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum5">   5:</span> <span style="color: #008000"> * any particular GDT layout, because we load our own as soon as we</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum6">   6:</span> <span style="color: #008000"> * can.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum7">   7:</span> <span style="color: #008000"> */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum8">   8:</span> __HEAD</pre><!--CRLF--><pre><span style="color: #606060" id="lnum9">   9:</span> ENTRY(startup_32)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum10">  10:</span>     movl pa(stack_start),%ecx</pre><!--CRLF--><pre><span style="color: #606060" id="lnum11">  11:</span>     </pre><!--CRLF--><pre><span style="color: #606060" id="lnum12">  12:</span>     <span style="color: #008000">/* test KEEP_SEGMENTS flag to see if the bootloader is asking</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum13">  13:</span> <span style="color: #008000">        us to not reload segments */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum14">  14:</span>     testb $(1&lt;&lt;6), BP_loadflags(%esi)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum15">  15:</span>     jnz 2f</pre><!--CRLF--><pre><span style="color: #606060" id="lnum16">  16:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum17">  17:</span> <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum18">  18:</span> <span style="color: #008000"> * Set segments to known values.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum19">  19:</span> <span style="color: #008000"> */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum20">  20:</span>     lgdt pa(boot_gdt_descr)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum21">  21:</span>     movl $(__BOOT_DS),%eax</pre><!--CRLF--><pre><span style="color: #606060" id="lnum22">  22:</span>     movl %eax,%ds</pre><!--CRLF--><pre><span style="color: #606060" id="lnum23">  23:</span>     movl %eax,%es</pre><!--CRLF--><pre><span style="color: #606060" id="lnum24">  24:</span>     movl %eax,%fs</pre><!--CRLF--><pre><span style="color: #606060" id="lnum25">  25:</span>     movl %eax,%gs</pre><!--CRLF--><pre><span style="color: #606060" id="lnum26">  26:</span>     movl %eax,%ss</pre><!--CRLF--><pre><span style="color: #606060" id="lnum27">  27:</span> 2:</pre><!--CRLF--><pre><span style="color: #606060" id="lnum28">  28:</span>     leal -__PAGE_OFFSET(%ecx),%esp</pre><!--CRLF--></div></div>
<p>那么这二者有什么先后顺序吗？</p>
<hr>

<p>原来，思路到了这里是走进了一个误区，/compressed目录下面存放的是压缩后的代码，主要功能是解压缩内核；而/kernel目录下的才是真正的内核文件。</p>
<p>在/kernel目录下也有一个链接器的脚本文件arch/x86/kernel/vmlinux.lds.S</p>
<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
<div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre><span style="color: #606060" id="lnum1">   1:</span> <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum2">   2:</span> <span style="color: #008000"> * ld script for the x86 kernel</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum3">   3:</span> <span style="color: #008000"> *</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum4">   4:</span> <span style="color: #008000"> * Historic 32-bit version written by Martin Mares &lt;mj@atrey.karlin.mff.cuni.cz&gt;</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum5">   5:</span> <span style="color: #008000"> *</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum6">   6:</span> <span style="color: #008000"> * Modernisation, unification and other changes and fixes:</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum7">   7:</span> <span style="color: #008000"> *   Copyright (C) 2007-2009  Sam Ravnborg &lt;sam@ravnborg.org&gt;</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum8">   8:</span> <span style="color: #008000"> *</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum9">   9:</span> <span style="color: #008000"> *</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum10">  10:</span> <span style="color: #008000"> * Don't define absolute symbols until and unless you know that symbol</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum11">  11:</span> <span style="color: #008000"> * value is should remain constant even if kernel image is relocated</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum12">  12:</span> <span style="color: #008000"> * at run time. Absolute symbols are not relocated. If symbol value should</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum13">  13:</span> <span style="color: #008000"> * change if kernel is relocated, make the symbol section relative and</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum14">  14:</span> <span style="color: #008000"> * put it inside the section definition.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum15">  15:</span> <span style="color: #008000"> */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum16">  16:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum17">  17:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_32</pre><!--CRLF--><pre><span style="color: #606060" id="lnum18">  18:</span> <span style="color: #cc6633">#define</span> LOAD_OFFSET __PAGE_OFFSET</pre><!--CRLF--><pre><span style="color: #606060" id="lnum19">  19:</span> <span style="color: #cc6633">#else</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum20">  20:</span> <span style="color: #cc6633">#define</span> LOAD_OFFSET __START_KERNEL_map</pre><!--CRLF--><pre><span style="color: #606060" id="lnum21">  21:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum22">  22:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum23">  23:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>-generic/vmlinux.lds.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum24">  24:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>/<span style="color: #0000ff">asm</span>-offsets.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum25">  25:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>/thread_info.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum26">  26:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>/page_types.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum27">  27:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>/cache.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum28">  28:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>/boot.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum29">  29:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum30">  30:</span> <span style="color: #cc6633">#undef</span> i386     <span style="color: #008000">/* in case the preprocessor is a 32bit one */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum31">  31:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum32">  32:</span> OUTPUT_FORMAT(CONFIG_OUTPUT_FORMAT, CONFIG_OUTPUT_FORMAT, CONFIG_OUTPUT_FORMAT)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum33">  33:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum34">  34:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_32</pre><!--CRLF--><pre><span style="color: #606060" id="lnum35">  35:</span> OUTPUT_ARCH(i386)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum36">  36:</span> ENTRY(phys_startup_32)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum37">  37:</span> jiffies = jiffies_64;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum38">  38:</span> <span style="color: #cc6633">#else</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum39">  39:</span> OUTPUT_ARCH(i386:x86-64)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum40">  40:</span> ENTRY(phys_startup_64)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum41">  41:</span> jiffies_64 = jiffies;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum42">  42:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum43">  43:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum44">  44:</span> <span style="color: #cc6633">#if</span> defined(CONFIG_X86_64) &amp;&amp; defined(CONFIG_DEBUG_RODATA)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum45">  45:</span> <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum46">  46:</span> <span style="color: #008000"> * On 64-bit, align RODATA to 2MB so that even with CONFIG_DEBUG_RODATA</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum47">  47:</span> <span style="color: #008000"> * we retain large page mappings for boundaries spanning kernel text, rodata</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum48">  48:</span> <span style="color: #008000"> * and data sections.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum49">  49:</span> <span style="color: #008000"> *</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum50">  50:</span> <span style="color: #008000"> * However, kernel identity mappings will have different RWX permissions</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum51">  51:</span> <span style="color: #008000"> * to the pages mapping to text and to the pages padding (which are freed) the</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum52">  52:</span> <span style="color: #008000"> * text section. Hence kernel identity mappings will be broken to smaller</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum53">  53:</span> <span style="color: #008000"> * pages. For 64-bit, kernel text and kernel identity mappings are different,</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum54">  54:</span> <span style="color: #008000"> * so we can enable protection checks that come with CONFIG_DEBUG_RODATA,</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum55">  55:</span> <span style="color: #008000"> * as well as retain 2MB large page mappings for kernel text.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum56">  56:</span> <span style="color: #008000"> */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum57">  57:</span> <span style="color: #cc6633">#define</span> X64_ALIGN_DEBUG_RODATA_BEGIN    . = ALIGN(HPAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum58">  58:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum59">  59:</span> <span style="color: #cc6633">#define</span> X64_ALIGN_DEBUG_RODATA_END                \</pre><!--CRLF--><pre><span style="color: #606060" id="lnum60">  60:</span>         . = ALIGN(HPAGE_SIZE);                \</pre><!--CRLF--><pre><span style="color: #606060" id="lnum61">  61:</span>         __end_rodata_hpage_align = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum62">  62:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum63">  63:</span> <span style="color: #cc6633">#else</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum64">  64:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum65">  65:</span> <span style="color: #cc6633">#define</span> X64_ALIGN_DEBUG_RODATA_BEGIN</pre><!--CRLF--><pre><span style="color: #606060" id="lnum66">  66:</span> <span style="color: #cc6633">#define</span> X64_ALIGN_DEBUG_RODATA_END</pre><!--CRLF--><pre><span style="color: #606060" id="lnum67">  67:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum68">  68:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum69">  69:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum70">  70:</span> PHDRS {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum71">  71:</span>     text PT_LOAD FLAGS(5);          <span style="color: #008000">/* R_E */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum72">  72:</span>     data PT_LOAD FLAGS(6);          <span style="color: #008000">/* RW_ */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum73">  73:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_64</pre><!--CRLF--><pre><span style="color: #606060" id="lnum74">  74:</span>     user PT_LOAD FLAGS(5);          <span style="color: #008000">/* R_E */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum75">  75:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_SMP</pre><!--CRLF--><pre><span style="color: #606060" id="lnum76">  76:</span>     percpu PT_LOAD FLAGS(6);        <span style="color: #008000">/* RW_ */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum77">  77:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum78">  78:</span>     init PT_LOAD FLAGS(7);          <span style="color: #008000">/* RWE */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum79">  79:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum80">  80:</span>     note PT_NOTE FLAGS(0);          <span style="color: #008000">/* ___ */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum81">  81:</span> }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum82">  82:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum83">  83:</span> SECTIONS</pre><!--CRLF--><pre><span style="color: #606060" id="lnum84">  84:</span> {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum85">  85:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_32</pre><!--CRLF--><pre><span style="color: #606060" id="lnum86">  86:</span>         . = LOAD_OFFSET + LOAD_PHYSICAL_ADDR;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum87">  87:</span>         phys_startup_32 = startup_32 - LOAD_OFFSET;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum88">  88:</span> <span style="color: #cc6633">#else</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum89">  89:</span>         . = __START_KERNEL;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum90">  90:</span>         phys_startup_64 = startup_64 - LOAD_OFFSET;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum91">  91:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum92">  92:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum93">  93:</span>     <span style="color: #008000">/* Text and read-only data */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum94">  94:</span>     .text :  AT(ADDR(.text) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum95">  95:</span>         _text = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum96">  96:</span>         <span style="color: #008000">/* bootstrapping code */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum97">  97:</span>         HEAD_TEXT</pre><!--CRLF--><pre><span style="color: #606060" id="lnum98">  98:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_32</pre><!--CRLF--><pre><span style="color: #606060" id="lnum99">  99:</span>         . = ALIGN(PAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum100"> 100:</span>         *(.text..page_aligned)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum101"> 101:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum102"> 102:</span>         . = ALIGN(8);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum103"> 103:</span>         _stext = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum104"> 104:</span>         TEXT_TEXT</pre><!--CRLF--><pre><span style="color: #606060" id="lnum105"> 105:</span>         SCHED_TEXT</pre><!--CRLF--><pre><span style="color: #606060" id="lnum106"> 106:</span>         LOCK_TEXT</pre><!--CRLF--><pre><span style="color: #606060" id="lnum107"> 107:</span>         KPROBES_TEXT</pre><!--CRLF--><pre><span style="color: #606060" id="lnum108"> 108:</span>         ENTRY_TEXT</pre><!--CRLF--><pre><span style="color: #606060" id="lnum109"> 109:</span>         IRQENTRY_TEXT</pre><!--CRLF--><pre><span style="color: #606060" id="lnum110"> 110:</span>         *(.fixup)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum111"> 111:</span>         *(.gnu.warning)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum112"> 112:</span>         <span style="color: #008000">/* End of text section */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum113"> 113:</span>         _etext = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum114"> 114:</span>     } :text = 0x9090</pre><!--CRLF--><pre><span style="color: #606060" id="lnum115"> 115:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum116"> 116:</span>     NOTES :text :note</pre><!--CRLF--><pre><span style="color: #606060" id="lnum117"> 117:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum118"> 118:</span>     EXCEPTION_TABLE(16) :text = 0x9090</pre><!--CRLF--><pre><span style="color: #606060" id="lnum119"> 119:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum120"> 120:</span> <span style="color: #cc6633">#if</span> defined(CONFIG_DEBUG_RODATA)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum121"> 121:</span>     <span style="color: #008000">/* .text should occupy whole number of pages */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum122"> 122:</span>     . = ALIGN(PAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum123"> 123:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum124"> 124:</span>     X64_ALIGN_DEBUG_RODATA_BEGIN</pre><!--CRLF--><pre><span style="color: #606060" id="lnum125"> 125:</span>     RO_DATA(PAGE_SIZE)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum126"> 126:</span>     X64_ALIGN_DEBUG_RODATA_END</pre><!--CRLF--><pre><span style="color: #606060" id="lnum127"> 127:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum128"> 128:</span>     <span style="color: #008000">/* Data */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum129"> 129:</span>     .data : AT(ADDR(.data) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum130"> 130:</span>         <span style="color: #008000">/* Start of data section */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum131"> 131:</span>         _sdata = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum132"> 132:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum133"> 133:</span>         <span style="color: #008000">/* init_task */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum134"> 134:</span>         INIT_TASK_DATA(THREAD_SIZE)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum135"> 135:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum136"> 136:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_32</pre><!--CRLF--><pre><span style="color: #606060" id="lnum137"> 137:</span>         <span style="color: #008000">/* 32 bit has nosave before _edata */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum138"> 138:</span>         NOSAVE_DATA</pre><!--CRLF--><pre><span style="color: #606060" id="lnum139"> 139:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum140"> 140:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum141"> 141:</span>         PAGE_ALIGNED_DATA(PAGE_SIZE)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum142"> 142:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum143"> 143:</span>         CACHELINE_ALIGNED_DATA(L1_CACHE_BYTES)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum144"> 144:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum145"> 145:</span>         DATA_DATA</pre><!--CRLF--><pre><span style="color: #606060" id="lnum146"> 146:</span>         CONSTRUCTORS</pre><!--CRLF--><pre><span style="color: #606060" id="lnum147"> 147:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum148"> 148:</span>         <span style="color: #008000">/* rarely changed data like cpu maps */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum149"> 149:</span>         READ_MOSTLY_DATA(INTERNODE_CACHE_BYTES)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum150"> 150:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum151"> 151:</span>         <span style="color: #008000">/* End of data section */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum152"> 152:</span>         _edata = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum153"> 153:</span>     } :data</pre><!--CRLF--><pre><span style="color: #606060" id="lnum154"> 154:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum155"> 155:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_64</pre><!--CRLF--><pre><span style="color: #606060" id="lnum156"> 156:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum157"> 157:</span> <span style="color: #cc6633">#define</span> VSYSCALL_ADDR (-10*1024*1024)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum158"> 158:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum159"> 159:</span> <span style="color: #cc6633">#define</span> VLOAD_OFFSET (VSYSCALL_ADDR - __vsyscall_0 + LOAD_OFFSET)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum160"> 160:</span> <span style="color: #cc6633">#define</span> VLOAD(x) (ADDR(x) - VLOAD_OFFSET)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum161"> 161:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum162"> 162:</span> <span style="color: #cc6633">#define</span> VVIRT_OFFSET (VSYSCALL_ADDR - __vsyscall_0)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum163"> 163:</span> <span style="color: #cc6633">#define</span> VVIRT(x) (ADDR(x) - VVIRT_OFFSET)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum164"> 164:</span> <span style="color: #cc6633">#define</span> EMIT_VVAR(x, offset) .vsyscall_var_ ## x    \</pre><!--CRLF--><pre><span style="color: #606060" id="lnum165"> 165:</span>     ADDR(.vsyscall_0) + offset             \</pre><!--CRLF--><pre><span style="color: #606060" id="lnum166"> 166:</span>     : AT(VLOAD(.vsyscall_var_ ## x)) {             \</pre><!--CRLF--><pre><span style="color: #606060" id="lnum167"> 167:</span>         *(.vsyscall_var_ ## x)            \</pre><!--CRLF--><pre><span style="color: #606060" id="lnum168"> 168:</span>     }                        \</pre><!--CRLF--><pre><span style="color: #606060" id="lnum169"> 169:</span>     x = VVIRT(.vsyscall_var_ ## x);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum170"> 170:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum171"> 171:</span>     . = ALIGN(4096);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum172"> 172:</span>     __vsyscall_0 = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum173"> 173:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum174"> 174:</span>     . = VSYSCALL_ADDR;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum175"> 175:</span>     .vsyscall_0 : AT(VLOAD(.vsyscall_0)) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum176"> 176:</span>         *(.vsyscall_0)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum177"> 177:</span>     } :user</pre><!--CRLF--><pre><span style="color: #606060" id="lnum178"> 178:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum179"> 179:</span>     . = ALIGN(L1_CACHE_BYTES);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum180"> 180:</span>     .vsyscall_fn : AT(VLOAD(.vsyscall_fn)) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum181"> 181:</span>         *(.vsyscall_fn)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum182"> 182:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum183"> 183:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum184"> 184:</span>     .vsyscall_1 ADDR(.vsyscall_0) + 1024: AT(VLOAD(.vsyscall_1)) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum185"> 185:</span>         *(.vsyscall_1)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum186"> 186:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum187"> 187:</span>     .vsyscall_2 ADDR(.vsyscall_0) + 2048: AT(VLOAD(.vsyscall_2)) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum188"> 188:</span>         *(.vsyscall_2)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum189"> 189:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum190"> 190:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum191"> 191:</span>     .vsyscall_3 ADDR(.vsyscall_0) + 3072: AT(VLOAD(.vsyscall_3)) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum192"> 192:</span>         *(.vsyscall_3)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum193"> 193:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum194"> 194:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum195"> 195:</span> <span style="color: #cc6633">#define</span> __VVAR_KERNEL_LDS</pre><!--CRLF--><pre><span style="color: #606060" id="lnum196"> 196:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>/vvar.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum197"> 197:</span> <span style="color: #cc6633">#undef</span> __VVAR_KERNEL_LDS</pre><!--CRLF--><pre><span style="color: #606060" id="lnum198"> 198:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum199"> 199:</span>     . = __vsyscall_0 + PAGE_SIZE;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum200"> 200:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum201"> 201:</span> <span style="color: #cc6633">#undef</span> VSYSCALL_ADDR</pre><!--CRLF--><pre><span style="color: #606060" id="lnum202"> 202:</span> <span style="color: #cc6633">#undef</span> VLOAD_OFFSET</pre><!--CRLF--><pre><span style="color: #606060" id="lnum203"> 203:</span> <span style="color: #cc6633">#undef</span> VLOAD</pre><!--CRLF--><pre><span style="color: #606060" id="lnum204"> 204:</span> <span style="color: #cc6633">#undef</span> VVIRT_OFFSET</pre><!--CRLF--><pre><span style="color: #606060" id="lnum205"> 205:</span> <span style="color: #cc6633">#undef</span> VVIRT</pre><!--CRLF--><pre><span style="color: #606060" id="lnum206"> 206:</span> <span style="color: #cc6633">#undef</span> EMIT_VVAR</pre><!--CRLF--><pre><span style="color: #606060" id="lnum207"> 207:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum208"> 208:</span> <span style="color: #cc6633">#endif</span> <span style="color: #008000">/* CONFIG_X86_64 */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum209"> 209:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum210"> 210:</span>     <span style="color: #008000">/* Init code and data - will be freed after init */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum211"> 211:</span>     . = ALIGN(PAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum212"> 212:</span>     .init.begin : AT(ADDR(.init.begin) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum213"> 213:</span>         __init_begin = .; <span style="color: #008000">/* paired with __init_end */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum214"> 214:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum215"> 215:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum216"> 216:</span> <span style="color: #cc6633">#if</span> defined(CONFIG_X86_64) &amp;&amp; defined(CONFIG_SMP)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum217"> 217:</span>     <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum218"> 218:</span> <span style="color: #008000">     * percpu offsets are zero-based on SMP.  PERCPU_VADDR() changes the</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum219"> 219:</span> <span style="color: #008000">     * output PHDR, so the next output section - .init.text - should</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum220"> 220:</span> <span style="color: #008000">     * start another segment - init.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum221"> 221:</span> <span style="color: #008000">     */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum222"> 222:</span>     PERCPU_VADDR(INTERNODE_CACHE_BYTES, 0, :percpu)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum223"> 223:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum224"> 224:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum225"> 225:</span>     INIT_TEXT_SECTION(PAGE_SIZE)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum226"> 226:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_64</pre><!--CRLF--><pre><span style="color: #606060" id="lnum227"> 227:</span>     :init</pre><!--CRLF--><pre><span style="color: #606060" id="lnum228"> 228:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum229"> 229:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum230"> 230:</span>     INIT_DATA_SECTION(16)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum231"> 231:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum232"> 232:</span>     <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum233"> 233:</span> <span style="color: #008000">     * Code and data for a variety of lowlevel trampolines, to be</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum234"> 234:</span> <span style="color: #008000">     * copied into base memory (&lt; 1 MiB) during initialization.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum235"> 235:</span> <span style="color: #008000">     * Since it is copied early, the main copy can be discarded</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum236"> 236:</span> <span style="color: #008000">     * afterwards.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum237"> 237:</span> <span style="color: #008000">     */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum238"> 238:</span>      .x86_trampoline : AT(ADDR(.x86_trampoline) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum239"> 239:</span>         x86_trampoline_start = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum240"> 240:</span>         *(.x86_trampoline)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum241"> 241:</span>         x86_trampoline_end = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum242"> 242:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum243"> 243:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum244"> 244:</span>     .x86_cpu_dev.init : AT(ADDR(.x86_cpu_dev.init) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum245"> 245:</span>         __x86_cpu_dev_start = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum246"> 246:</span>         *(.x86_cpu_dev.init)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum247"> 247:</span>         __x86_cpu_dev_end = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum248"> 248:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum249"> 249:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum250"> 250:</span>     <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum251"> 251:</span> <span style="color: #008000">     * start address and size of operations which during runtime</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum252"> 252:</span> <span style="color: #008000">     * can be patched with virtualization friendly instructions or</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum253"> 253:</span> <span style="color: #008000">     * baremetal native ones. Think page table operations.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum254"> 254:</span> <span style="color: #008000">     * Details in paravirt_types.h</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum255"> 255:</span> <span style="color: #008000">     */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum256"> 256:</span>     . = ALIGN(8);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum257"> 257:</span>     .parainstructions : AT(ADDR(.parainstructions) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum258"> 258:</span>         __parainstructions = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum259"> 259:</span>         *(.parainstructions)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum260"> 260:</span>         __parainstructions_end = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum261"> 261:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum262"> 262:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum263"> 263:</span>     <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum264"> 264:</span> <span style="color: #008000">     * struct alt_inst entries. From the header (alternative.h):</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum265"> 265:</span> <span style="color: #008000">     * "Alternative instructions for different CPU types or capabilities"</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum266"> 266:</span> <span style="color: #008000">     * Think locking instructions on spinlocks.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum267"> 267:</span> <span style="color: #008000">     */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum268"> 268:</span>     . = ALIGN(8);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum269"> 269:</span>     .altinstructions : AT(ADDR(.altinstructions) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum270"> 270:</span>         __alt_instructions = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum271"> 271:</span>         *(.altinstructions)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum272"> 272:</span>         __alt_instructions_end = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum273"> 273:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum274"> 274:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum275"> 275:</span>     <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum276"> 276:</span> <span style="color: #008000">     * And here are the replacement instructions. The linker sticks</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum277"> 277:</span> <span style="color: #008000">     * them as binary blobs. The .altinstructions has enough data to</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum278"> 278:</span> <span style="color: #008000">     * get the address and the length of them to patch the kernel safely.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum279"> 279:</span> <span style="color: #008000">     */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum280"> 280:</span>     .altinstr_replacement : AT(ADDR(.altinstr_replacement) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum281"> 281:</span>         *(.altinstr_replacement)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum282"> 282:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum283"> 283:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum284"> 284:</span>     <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum285"> 285:</span> <span style="color: #008000">     * struct iommu_table_entry entries are injected in this section.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum286"> 286:</span> <span style="color: #008000">     * It is an array of IOMMUs which during run time gets sorted depending</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum287"> 287:</span> <span style="color: #008000">     * on its dependency order. After rootfs_initcall is complete</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum288"> 288:</span> <span style="color: #008000">     * this section can be safely removed.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum289"> 289:</span> <span style="color: #008000">     */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum290"> 290:</span>     .iommu_table : AT(ADDR(.iommu_table) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum291"> 291:</span>         __iommu_table = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum292"> 292:</span>         *(.iommu_table)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum293"> 293:</span>         __iommu_table_end = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum294"> 294:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum295"> 295:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum296"> 296:</span>     . = ALIGN(8);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum297"> 297:</span>     .apicdrivers : AT(ADDR(.apicdrivers) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum298"> 298:</span>         __apicdrivers = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum299"> 299:</span>         *(.apicdrivers);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum300"> 300:</span>         __apicdrivers_end = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum301"> 301:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum302"> 302:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum303"> 303:</span>     . = ALIGN(8);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum304"> 304:</span>     <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum305"> 305:</span> <span style="color: #008000">     * .exit.text is discard at runtime, not link time, to deal with</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum306"> 306:</span> <span style="color: #008000">     *  references from .altinstructions and .eh_frame</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum307"> 307:</span> <span style="color: #008000">     */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum308"> 308:</span>     .exit.text : AT(ADDR(.exit.text) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum309"> 309:</span>         EXIT_TEXT</pre><!--CRLF--><pre><span style="color: #606060" id="lnum310"> 310:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum311"> 311:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum312"> 312:</span>     .exit.data : AT(ADDR(.exit.data) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum313"> 313:</span>         EXIT_DATA</pre><!--CRLF--><pre><span style="color: #606060" id="lnum314"> 314:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum315"> 315:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum316"> 316:</span> <span style="color: #cc6633">#if</span> !defined(CONFIG_X86_64) || !defined(CONFIG_SMP)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum317"> 317:</span>     PERCPU_SECTION(INTERNODE_CACHE_BYTES)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum318"> 318:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum319"> 319:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum320"> 320:</span>     . = ALIGN(PAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum321"> 321:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum322"> 322:</span>     <span style="color: #008000">/* freed after init ends here */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum323"> 323:</span>     .init.end : AT(ADDR(.init.end) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum324"> 324:</span>         __init_end = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum325"> 325:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum326"> 326:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum327"> 327:</span>     <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum328"> 328:</span> <span style="color: #008000">     * smp_locks might be freed after init</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum329"> 329:</span> <span style="color: #008000">     * start/end must be page aligned</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum330"> 330:</span> <span style="color: #008000">     */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum331"> 331:</span>     . = ALIGN(PAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum332"> 332:</span>     .smp_locks : AT(ADDR(.smp_locks) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum333"> 333:</span>         __smp_locks = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum334"> 334:</span>         *(.smp_locks)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum335"> 335:</span>         . = ALIGN(PAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum336"> 336:</span>         __smp_locks_end = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum337"> 337:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum338"> 338:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum339"> 339:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_64</pre><!--CRLF--><pre><span style="color: #606060" id="lnum340"> 340:</span>     .data_nosave : AT(ADDR(.data_nosave) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum341"> 341:</span>         NOSAVE_DATA</pre><!--CRLF--><pre><span style="color: #606060" id="lnum342"> 342:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum343"> 343:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum344"> 344:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum345"> 345:</span>     <span style="color: #008000">/* BSS */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum346"> 346:</span>     . = ALIGN(PAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum347"> 347:</span>     .bss : AT(ADDR(.bss) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum348"> 348:</span>         __bss_start = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum349"> 349:</span>         *(.bss..page_aligned)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum350"> 350:</span>         *(.bss)</pre><!--CRLF--><pre><span style="color: #606060" id="lnum351"> 351:</span>         . = ALIGN(PAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum352"> 352:</span>         __bss_stop = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum353"> 353:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum354"> 354:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum355"> 355:</span>     . = ALIGN(PAGE_SIZE);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum356"> 356:</span>     .brk : AT(ADDR(.brk) - LOAD_OFFSET) {</pre><!--CRLF--><pre><span style="color: #606060" id="lnum357"> 357:</span>         __brk_base = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum358"> 358:</span>         . += 64 * 1024;        <span style="color: #008000">/* 64k alignment slop space */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum359"> 359:</span>         *(.brk_reservation)    <span style="color: #008000">/* areas brk users have reserved */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum360"> 360:</span>         __brk_limit = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum361"> 361:</span>     }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum362"> 362:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum363"> 363:</span>     _end = .;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum364"> 364:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum365"> 365:</span>         STABS_DEBUG</pre><!--CRLF--><pre><span style="color: #606060" id="lnum366"> 366:</span>         DWARF_DEBUG</pre><!--CRLF--><pre><span style="color: #606060" id="lnum367"> 367:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum368"> 368:</span>     <span style="color: #008000">/* Sections to be discarded */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum369"> 369:</span>     DISCARDS</pre><!--CRLF--><pre><span style="color: #606060" id="lnum370"> 370:</span>     /DISCARD/ : { *(.eh_frame) }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum371"> 371:</span> }</pre><!--CRLF--><pre><span style="color: #606060" id="lnum372"> 372:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum373"> 373:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum374"> 374:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_32</pre><!--CRLF--><pre><span style="color: #606060" id="lnum375"> 375:</span> <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum376"> 376:</span> <span style="color: #008000"> * The ASSERT() sink to . is intentional, for binutils 2.14 compatibility:</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum377"> 377:</span> <span style="color: #008000"> */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum378"> 378:</span> . = ASSERT((_end - LOAD_OFFSET &lt;= KERNEL_IMAGE_SIZE),</pre><!--CRLF--><pre><span style="color: #606060" id="lnum379"> 379:</span>        <span style="color: #006080">"kernel image bigger than KERNEL_IMAGE_SIZE"</span>);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum380"> 380:</span> <span style="color: #cc6633">#else</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum381"> 381:</span> <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum382"> 382:</span> <span style="color: #008000"> * Per-cpu symbols which need to be offset from __per_cpu_load</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum383"> 383:</span> <span style="color: #008000"> * for the boot processor.</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum384"> 384:</span> <span style="color: #008000"> */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum385"> 385:</span> <span style="color: #cc6633">#define</span> INIT_PER_CPU(x) init_per_cpu__##x = x + __per_cpu_load</pre><!--CRLF--><pre><span style="color: #606060" id="lnum386"> 386:</span> INIT_PER_CPU(gdt_page);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum387"> 387:</span> INIT_PER_CPU(irq_stack_union);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum388"> 388:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum389"> 389:</span> <span style="color: #008000">/*</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum390"> 390:</span> <span style="color: #008000"> * Build-time check on the image size:</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum391"> 391:</span> <span style="color: #008000"> */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum392"> 392:</span> . = ASSERT((_end - _text &lt;= KERNEL_IMAGE_SIZE),</pre><!--CRLF--><pre><span style="color: #606060" id="lnum393"> 393:</span>        <span style="color: #006080">"kernel image bigger than KERNEL_IMAGE_SIZE"</span>);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum394"> 394:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum395"> 395:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_SMP</pre><!--CRLF--><pre><span style="color: #606060" id="lnum396"> 396:</span> . = ASSERT((irq_stack_union == 0),</pre><!--CRLF--><pre><span style="color: #606060" id="lnum397"> 397:</span>            <span style="color: #006080">"irq_stack_union is not at start of per-cpu area"</span>);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum398"> 398:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum399"> 399:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum400"> 400:</span> <span style="color: #cc6633">#endif</span> <span style="color: #008000">/* CONFIG_X86_32 */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum401"> 401:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum402"> 402:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_KEXEC</pre><!--CRLF--><pre><span style="color: #606060" id="lnum403"> 403:</span> <span style="color: #cc6633">#include</span> &lt;<span style="color: #0000ff">asm</span>/kexec.h&gt;</pre><!--CRLF--><pre><span style="color: #606060" id="lnum404"> 404:</span>&nbsp; </pre><!--CRLF--><pre><span style="color: #606060" id="lnum405"> 405:</span> . = ASSERT(kexec_control_code_size &lt;= KEXEC_CONTROL_CODE_MAX_SIZE,</pre><!--CRLF--><pre><span style="color: #606060" id="lnum406"> 406:</span>            <span style="color: #006080">"kexec control code size is too big"</span>);</pre><!--CRLF--><pre><span style="color: #606060" id="lnum407"> 407:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum408"> 408:</span>&nbsp; </pre><!--CRLF--></div>
<p>&nbsp;</p></div>
<blockquote>
<p>SECTIONS<br>{<br>#ifdef CONFIG_X86_32<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #ff0000">. = LOAD_OFFSET + LOAD_PHYSICAL_ADDR;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; phys_startup_32 = startup_32 - LOAD_OFFSET;<br>#else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; . = __START_KERNEL;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; phys_startup_64 = startup_64 - LOAD_OFFSET;<br>#endif</p>
<p>&nbsp;&nbsp;&nbsp; /* Text and read-only data */<br>&nbsp;&nbsp;&nbsp; .text :&nbsp; AT(ADDR(.text) - LOAD_OFFSET) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _text = .;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* bootstrapping code */<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #9b00d3">HEAD_TEXT<br></span>#ifdef CONFIG_X86_32<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; . = ALIGN(PAGE_SIZE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *(.text..page_aligned)<br>#endif<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; . = ALIGN(8);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _stext = .;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TEXT_TEXT<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SCHED_TEXT<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOCK_TEXT<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KPROBES_TEXT<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ENTRY_TEXT<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IRQENTRY_TEXT<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *(.fixup)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *(.gnu.warning)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* End of text section */<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _etext = .;<br>&nbsp;&nbsp;&nbsp; } :text = 0x9090</p></blockquote>
<p>其中</p>
<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
<div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum1">   1:</span>&nbsp; </pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum2">   2:</span> <span style="color: #cc6633">#ifdef</span> CONFIG_X86_32</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum3">   3:</span> <span style="color: #cc6633">#define</span> LOAD_OFFSET __PAGE_OFFSET</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum4">   4:</span> <span style="color: #cc6633">#else</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum5">   5:</span> <span style="color: #cc6633">#define</span> LOAD_OFFSET __START_KERNEL_map</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum6">   6:</span> <span style="color: #cc6633">#endif</span></pre><!--CRLF--></div></div>
<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
<div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre><span style="color: #606060" id="lnum1">   1:</span> <span style="color: #008000">/* Physical address where kernel should be loaded. */</span></pre><!--CRLF--><pre><span style="color: #606060" id="lnum2">   2:</span> <span style="color: #cc6633">#define</span> LOAD_PHYSICAL_ADDR ((CONFIG_PHYSICAL_START \</pre><!--CRLF--><pre><span style="color: #606060" id="lnum3">   3:</span>                 + (CONFIG_PHYSICAL_ALIGN - 1)) \</pre><!--CRLF--><pre><span style="color: #606060" id="lnum4">   4:</span>                 &amp; ~(CONFIG_PHYSICAL_ALIGN - 1))</pre><!--CRLF--></div></div>
<blockquote>
<p><strike>config PHYSICAL_START<br>&nbsp;&nbsp;&nbsp; hex "Physical address where the kernel is loaded" if (EXPERT || CRASH_DUMP)<br>&nbsp;&nbsp;&nbsp; default "0x1000000"<br>&nbsp;&nbsp;&nbsp; ---help---<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This gives the physical address where the kernel is loaded.</strike></p>
<p><strike>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If kernel is a not relocatable (CONFIG_RELOCATABLE=n) then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bzImage will decompress itself to above physical address and<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; run from there. Otherwise, bzImage will run from the address where<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; it has been loaded by the boot loader and will ignore above physical<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; address.</strike></p>
<p><strike>[arch/x86/Kconfig]</strike></p></blockquote>
<p>因此红色语句将.[当前标号]定位到3GB+1MB(0xC0100000)虚拟地址处</p>
<p><strike>1MB物理内存处</strike></p>
<blockquote>
<p>#define HEAD_TEXT&nbsp; *(.head.text)</p>
<p>&nbsp;</p></blockquote>
<p>因此，可以确认，1MB物理内存处是arch/x86/kernel/head_32.S中的startup_32函数</p>
<p>&nbsp;</p>
<h3>2. startup_32函数</h3>
<p>该函数也是通过汇编定义</p>
<blockquote>
<p>#define PAGE_TABLE_SIZE(pages) ((pages) / PTRS_PER_PGD)</p>
<p>&nbsp;</p>
<p>/* Number of possible pages in the lowmem region */<br>LOWMEM_PAGES = (((1&lt;&lt;32) - __PAGE_OFFSET) &gt;&gt; PAGE_SHIFT)<br>&nbsp;&nbsp;&nbsp; <br>/* Enough space to fit pagetables for the low memory linear map */<br>MAPPING_BEYOND_END = PAGE_TABLE_SIZE(LOWMEM_PAGES) &lt;&lt; PAGE_SHIFT</p>
<p>/*<br>* Worst-case size of the kernel mapping we need to make:<br>* a relocatable kernel can live anywhere in lowmem, so we need to be able<br>* to map all of lowmem.<br>*/<br>KERNEL_PAGES = LOWMEM_PAGES</p>
<p>INIT_MAP_SIZE = PAGE_TABLE_SIZE(KERNEL_PAGES) * PAGE_SIZE</p></blockquote>
<p>LOWMEM_PAGES为1GB大小，即内核态的内存空间范围。</p>
<p><strong>long(((long long)1 &lt;&lt; 32 ) / 4) &gt;&gt; 12 = 0x00040000</strong></p>
<p>即需要0x40000个页表项来表示内核可能用到的地址空间。</p>
<p><strong>PAGE_TABLE_SIZE(0x40000) = 0x40000 / 1024 = 0x100</strong></p>
<p>需要页目录能包含0x100（256）个项目，每个项目用于指定对应的页表的物理地址，每个页目录项为32位。因此需要</p>
<p><strong>0x100 * 4 = 1024bytes = 1KB</strong></p>
<p>来保存内核需要的页目录项目。</p>
<p>接下来，分配存放内核页表的内存空间：</p>
<blockquote>
<p>RESERVE_BRK(pagetables, INIT_MAP_SIZE)</p>
<p>&nbsp;</p></blockquote>
<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
<div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum1">   1:</span> <span style="color: #008000">/*</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum2">   2:</span> <span style="color: #008000"> * Reserve space in the brk section.  The name must be unique within</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum3">   3:</span> <span style="color: #008000"> * the file, and somewhat descriptive.  The size is in bytes.  Must be</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum4">   4:</span> <span style="color: #008000"> * used at file scope.</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum5">   5:</span> <span style="color: #008000"> *</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum6">   6:</span> <span style="color: #008000"> * (This uses a temp function to wrap the asm so we can pass it the</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum7">   7:</span> <span style="color: #008000"> * size parameter; otherwise we wouldn't be able to.  We can't use a</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum8">   8:</span> <span style="color: #008000"> * "section" attribute on a normal variable because it always ends up</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum9">   9:</span> <span style="color: #008000"> * being @progbits, which ends up allocating space in the vmlinux</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum10">  10:</span> <span style="color: #008000"> * executable.)</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum11">  11:</span> <span style="color: #008000"> */</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum12">  12:</span> <span style="color: #cc6633">#define</span> RESERVE_BRK(name,sz)                        \</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum13">  13:</span>     <span style="color: #0000ff">static</span> <span style="color: #0000ff">void</span> __section(.discard.text) __used notrace        \</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum14">  14:</span>     __brk_reservation_fn_##name##__(<span style="color: #0000ff">void</span>) {                \</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum15">  15:</span>         <span style="color: #0000ff">asm</span> <span style="color: #0000ff">volatile</span> (                        \</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum16">  16:</span>             <span style="color: #006080">".pushsection .brk_reservation,\"aw\",@nobits;"</span> \</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum17">  17:</span>             <span style="color: #006080">".brk."</span> #name <span style="color: #006080">":"</span>                \</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum18">  18:</span>             <span style="color: #006080">" 1:.skip %c0;"</span>                    \</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum19">  19:</span>             <span style="color: #006080">" .size .brk."</span> #name <span style="color: #006080">", . - 1b;"</span>        \</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum20">  20:</span>             <span style="color: #006080">" .popsection"</span>                    \</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum21">  21:</span>             : : <span style="color: #006080">"i"</span> (sz));                    \</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum22">  22:</span>     }</pre><!--CRLF--></div></div>
<p>相当于分配一个.brk.pagetables的section，大小为1KB。</p>
<p>下面这段代码，检查bootloader有没有明确地指示不要重新设置各个段选择子的内容，如果可以，就将各个数据段选择子都重置为BOOT_DS段选择子。</p>
<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
<div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum1">   1:</span> <span style="color: #008000">/* test KEEP_SEGMENTS flag to see if the bootloader is asking</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum2">   2:</span> <span style="color: #008000">    us to not reload segments */</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum3">   3:</span> testb $(1&lt;&lt;6), BP_loadflags(%esi)</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum4">   4:</span> jnz 2f</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum5">   5:</span>&nbsp; </pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum6">   6:</span> /*</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum7">   7:</span> et segments to known values.</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum8">   8:</span>&nbsp; </pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum9">   9:</span> lgdt pa(boot_gdt_descr)</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum10">  10:</span> movl $(__BOOT_DS),%eax</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum11">  11:</span> movl %eax,%ds</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum12">  12:</span> movl %eax,%es</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum13">  13:</span> movl %eax,%fs</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum14">  14:</span> movl %eax,%gs</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum15">  15:</span> movl %eax,%ss</pre><!--CRLF--></div></div>
<p>在上面.data section中有设置标号stack_start</p>
<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
<div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum1">   1:</span> .data</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum2">   2:</span> .balign 4</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum3">   3:</span> ENTRY(stack_start)</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum4">   4:</span>     .<span style="color: #0000ff">long</span> init_thread_union+THREAD_SIZE</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum5">   5:</span>&nbsp; </pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum6">   6:</span> early_recursion_flag:</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum7">   7:</span>     .<span style="color: #0000ff">long</span> 0</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum8">   8:</span>&nbsp; </pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum9">   9:</span> ready:    .byte 0</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum10">  10:</span>&nbsp; </pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum11">  11:</span> int_msg:</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum12">  12:</span>     .asciz <span style="color: #006080">"Unknown interrupt or fault at: %p %p %p\n"</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum13">  13:</span>&nbsp; </pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum14">  14:</span> fault_msg:</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum15">  15:</span> <span style="color: #008000">/* fault info: */</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum16">  16:</span>     .ascii <span style="color: #006080">"BUG: Int %d: CR2 %p\n"</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum17">  17:</span> <span style="color: #008000">/* pusha regs: */</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum18">  18:</span>     .ascii <span style="color: #006080">"     EDI %p  ESI %p  EBP %p  ESP %p\n"</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum19">  19:</span>     .ascii <span style="color: #006080">"     EBX %p  EDX %p  ECX %p  EAX %p\n"</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum20">  20:</span> <span style="color: #008000">/* fault frame: */</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum21">  21:</span>     .ascii <span style="color: #006080">"     err %p  EIP %p   CS %p  flg %p\n"</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum22">  22:</span>     .ascii <span style="color: #006080">"Stack: %p %p %p %p %p %p %p %p\n"</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum23">  23:</span>     .ascii <span style="color: #006080">"       %p %p %p %p %p %p %p %p\n"</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum24">  24:</span>     .asciz <span style="color: #006080">"       %p %p %p %p %p %p %p %p\n"</span></pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum25">  25:</span>&nbsp; </pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #606060" id="lnum26">  26:</span> <span style="color: #cc6633">#include</span> <span style="color: #006080">"../../x86/xen/xen-head.S"</span></pre><!--CRLF--></div></div></body>
</html>
